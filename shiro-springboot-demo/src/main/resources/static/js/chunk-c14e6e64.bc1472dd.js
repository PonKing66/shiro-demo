(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c14e6e64"],{4381:function(e,t,r){"use strict";r("6762"),r("2fdb");var n=r("4360");function i(e,t){var r=t.value,i=n["a"].getters&&n["a"].getters.roles;if(!(r&&r instanceof Array))throw new Error("你没有权限访问");if(r.length>0){var s=r,o=i.some((function(e){return s.includes(e)}));o||e.parentNode&&e.parentNode.removeChild(e)}}var s={inserted:function(e,t){i(e,t)},update:function(e,t){i(e,t)}},o=function(e){e.directive("permission",s)};window.Vue&&(window["permission"]=s,Vue.use(o)),s.install=o;t["a"]=s},cc5e:function(e,t,r){"use strict";r.d(t,"d",(function(){return s})),r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return a})),r.d(t,"e",(function(){return c})),r.d(t,"b",(function(){return l}));var n=r("b775"),i="/api/admin/roles";function s(){return Object(n["a"])({url:"/api/admin/permissions",method:"get"})}function o(){return Object(n["a"])({url:"".concat(i),method:"get"})}function a(e){return Object(n["a"])({url:"".concat(i),method:"post",data:e})}function c(e,t){return Object(n["a"])({url:"".concat(i,"/").concat(e),method:"put",data:t})}function l(e){return Object(n["a"])({url:"".concat(i,"/").concat(e),method:"delete"})}},d678:function(e,t,r){"use strict";var n=r("fae6"),i=r.n(n);i.a},d78e:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["role:add"],expression:"['role:add']"}],attrs:{type:"primary"},on:{click:e.handleAddRole}},[e._v("添加角色")]),e._v(" "),r("el-table",{staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.rolesList,border:""}},[r("el-table-column",{attrs:{align:"center",label:"Role Key",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.id)+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"Role Name",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.roleName)+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"header-center",label:"Description"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.description)+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["role:update"],expression:"['role:update']"}],attrs:{type:"primary",size:"small"},on:{click:function(r){return e.handleEdit(t)}}},[e._v("编辑")]),e._v(" "),r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["role:remove"],expression:"['role:remove']"}],attrs:{type:"danger",size:"small"},on:{click:function(r){return e.handleDelete(t)}}},[e._v("删除")])]}}])})],1),e._v(" "),r("el-dialog",{attrs:{visible:e.dialogVisible,title:"edit"===e.dialogType?"Edit Role":"New Role"},on:{"update:visible":function(t){e.dialogVisible=t}}},[r("el-form",{attrs:{model:e.role,"label-width":"80px","label-position":"left"}},[r("el-form-item",{attrs:{label:"Name"}},[r("el-input",{attrs:{placeholder:"Role Name"},model:{value:e.role.roleName,callback:function(t){e.$set(e.role,"roleName",t)},expression:"role.roleName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Desc"}},[r("el-input",{attrs:{autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"Role Description"},model:{value:e.role.description,callback:function(t){e.$set(e.role,"description",t)},expression:"role.description"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Menus"}},[r("el-tree",{ref:"tree",attrs:{data:e.routesData,"show-checkbox":"","node-key":"id",props:e.defaultProps}})],1)],1),e._v(" "),r("div",{staticStyle:{"text-align":"right"}},[r("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:e.confirmRole}},[e._v("确认")])],1)],1)],1)},i=[],s=(r("96cf"),r("1da1")),o=r("4381"),a=(r("e350"),r("ed08"),r("cc5e")),c={id:"",key:"",roleName:"",description:"",permissions:[]},l={directives:{permission:o["a"]},data:function(){return{listQuery:{page:1,limit:20},role:Object.assign({},c),routes:[],rolesList:[],dialogVisible:!1,dialogType:"new",defaultProps:{children:"children",label:"name"}}},computed:{routesData:function(){return this.routes}},created:function(){this.getRoutes(),this.getRoles()},methods:{getCheckedNodes:function(){console.log(this.$refs.tree.getCheckedNodes())},getCheckedKeys:function(){console.log(this.$refs.tree.getCheckedKeys())},getRoutes:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["d"])();case 2:t=e.sent,this.serviceRoutes=t.data,this.routes=this.generateRoutes(t.data);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getRoles:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["c"])();case 2:t=e.sent,this.rolesList=t.data;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),generateRoutes:function(e){return e},handleAddRole:function(){this.role=Object.assign({},c),this.$refs.tree&&this.$refs.tree.setCheckedNodes([]),this.dialogType="new",this.dialogVisible=!0},handleEdit:function(e){var t=this;this.dialogType="edit",this.dialogVisible=!0,this.$nextTick((function(){t.$refs.tree.setCheckedKeys([]);var r=e.row.permissions;t.role=e.row,t.$refs.tree.setCheckedKeys(r)}))},handleDelete:function(e){var t=this,r=e.$index,n=e.row;this.$confirm("Confirm to remove the role?","Warning",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then(Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(a["b"])(n.id);case 2:t.rolesList.splice(r,1),t.$message({type:"success",message:"Delete succed!"});case 4:case"end":return e.stop()}}),e)})))).catch((function(e){console.error(e)}))},confirmRole:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(){var t,r,n,i,s,o,c,l,u,d;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t="edit"===this.dialogType,r=this.$refs.tree.getCheckedKeys(),n=this.$refs.tree.getCheckedKeys(),this.role.permissions=r,!t){e.next=20;break}return e.next=7,Object(a["e"])(this.role.id,this.role);case 7:i=e.sent,s=i.code,2e4!==s&&(this.role.permissions=n),o=0;case 11:if(!(o<this.rolesList.length)){e.next=18;break}if(this.rolesList[o].id!==this.role.id){e.next=15;break}return this.rolesList.splice(o,1,Object.assign({},this.role)),e.abrupt("break",18);case 15:o++,e.next=11;break;case 18:e.next=25;break;case 20:return e.next=22,Object(a["a"])(this.role);case 22:e.sent,this.role.id=data.id,this.rolesList.push(this.role);case 25:c=this.role,l=c.description,u=c.id,d=c.roleName,this.dialogVisible=!1,this.$notify({title:"Success",dangerouslyUseHTMLString:!0,message:"\n            <div>Role Key: ".concat(u,"</div>\n            <div>Role Name: ").concat(d,"</div>\n            <div>Description: ").concat(l,"</div>\n          "),type:"success"});case 28:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},u=l,d=(r("d678"),r("2877")),f=Object(d["a"])(u,n,i,!1,null,"673dd125",null);t["default"]=f.exports},e350:function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));r("6762"),r("2fdb");var n=r("4360");function i(e){if(e&&e instanceof Array&&e.length>0){var t=n["a"].getters&&n["a"].getters.roles,r=e,i=t.some((function(e){return r.includes(e)}));return!!i}return console.error("你没有权限访问"),!1}},fae6:function(e,t,r){}}]);